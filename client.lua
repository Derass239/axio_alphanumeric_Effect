-------------------------------------------------
------ axio_alphanumeric_Effect by Derass -------
------------- Discord : Derass#4974 -------------
--------- https://discord.gg/HPD35pasA5 ---------
-------------------------------------------------

local fxs = {}

local asset = "cut_sil"
local particle = "cs_xm_pred_cloak_startup"

-- Inspired by https://www.dafont.com/5x5-dots.font
-- Letters and numbers are based on a 5*5 grid
-- Center is {0.0, 0.0}
-- Top Left is {-0.2, -0.2}
-- Bottom Right is {0.2, 0.2}
Letters = {
	["A"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ 0.2, 0.2 },
	},
	["B"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["C"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.2, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
		{ 0.2, 0.2 },
	},
	["D"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["E"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ -0.2, 0.2 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
		{ 0.2, 0.2 },
	},
	["F"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ -0.2, 0.1 },
		{ -0.2, 0.2 },
	},
	["G"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ -0.2, -0.1 },
		{ -0.2, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
		{ 0.2, 0.2 },
	},
	["H"] = {
		{ -0.2, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ 0.2, 0.2 },
	},
	["I"] = {
		{ 0, -0.2 },
		{ 0, -0.1 },
		{ 0, 0 },
		{ 0, 0.1 },
		{ 0, 0.2 },
	},
	["J"] = {
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ 0.2, -0.1 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["K"] = {
		{ -0.2, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ 0.2, 0.2 },
	},
	["L"] = {
		{ -0.2, -0.2 },
		{ -0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.2, 0.1 },
		{ -0.2, 0.2 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["M"] = {
		{ -0.2, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ -0.1, -0.1 },
		{ 0.1, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ 0, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ 0.2, 0.2 },
	},
	["N"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ 0, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ 0, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ 0, 0.1 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ 0.1, 0.2 },
		{ 0.2, 0.2 },
	},
	["O"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["P"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ -0.2, 0.1 },
		{ -0.2, 0.2 },
	},
	["Q"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ -0.2, -0.1 },
		{ 0.1, -0.1 },
		{ -0.2, 0 },
		{ 0.1, 0 },
		{ -0.2, 0.1 },
		{ 0.1, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
		{ 0.2, 0.2 },
	},
	["R"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ -0.2, 0.1 },
		{ 0.1, 0.1 },
		{ -0.2, 0.2 },
		{ 0.2, 0.2 },
	},
	["S"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["T"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ 0, -0.1 },
		{ 0, 0 },
		{ 0, 0.1 },
		{ 0, 0.2 },
	},
	["U"] = {
		{ -0.2, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["V"] = {
		{ -0.2, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.1, 0 },
		{ 0.1, 0 },
		{ -0.1, 0.1 },
		{ 0.1, 0.1 },
		{ 0, 0.2 },
	},
	["W"] = {
		{ -0.2, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ 0, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ -0.1, 0.1 },
		{ 0.1, 0.1 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ 0.2, 0.2 },
	},
	["X"] = {
		{ -0.2, -0.2 },
		{ 0.2, -0.2 },
		{ -0.1, -0.1 },
		{ 0.1, -0.1 },
		{ 0, 0 },
		{ -0.1, 0.1 },
		{ 0.1, 0.1 },
		{ -0.2, 0.2 },
		{ 0.2, 0.2 },
	},
	["Y"] = {
		{ -0.2, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0, 0.1 },
		{ 0, 0.2 },
	},
	["Z"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ 0.2, -0.1 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ -0.2, 0.1 },
		{ -0.2, 0.2 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
		{ 0.2, 0.2 },
	},
	["0"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0.1, -0.1 },
		{ 0.2, -0.1 },
		{ -0.2, 0 },
		{ 0, 0 },
		{ 0.2, 0 },
		{ -0.2, 0.1 },
		{ -0.1, 0.1 },
		{ 0.2, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["1"] = {
		{ 0, -0.2 },
		{ -0.1, -0.1 },
		{ 0, -0.1 },
		{ 0, 0 },
		{ 0, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["2"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.1 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ -0.2, 0.1 },
		{ -0.2, 0.2 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
		{ 0.2, 0.2 },
	},
	["3"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.1 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["4"] = {
		{ -0.2, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0.2, 0 },
		{ 0.2, 0.1 },
		{ 0.2, 0.2 },
	},
	["5"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0.2, 0.1 },
		{ -0.2, 0.2 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["6"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ -0.2, -0.1 },
		{ -0.2, 0 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["7"] = {
		{ -0.2, -0.2 },
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ 0.2, -0.2 },
		{ 0.2, -0.1 },
		{ 0.1, 0 },
		{ 0.1, 0.1 },
		{ 0.1, 0.2 },
	},
	["8"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ -0.2, 0.1 },
		{ 0.2, 0.1 },
		{ -0.1, 0.2 },
		{ 0, 0.2 },
		{ 0.1, 0.2 },
	},
	["9"] = {
		{ -0.1, -0.2 },
		{ 0, -0.2 },
		{ 0.1, -0.2 },
		{ -0.2, -0.1 },
		{ 0.2, -0.1 },
		{ -0.1, 0 },
		{ 0, 0 },
		{ 0.1, 0 },
		{ 0.2, 0 },
		{ 0.2, 0.1 },
		{ 0.1, 0.2 },
		{ 0.2, 0.2 },
	},
}

local function LoadAsset()
	if not HasNamedPtfxAssetLoaded(asset) then
		RequestNamedPtfxAsset(asset)
		while not HasNamedPtfxAssetLoaded(asset) do
			Wait(0)
		end
	end
end

local function StopFireworkText()
	for _, v in pairs(fxs) do
		StopParticleFxLooped(v, 0)
	end
end
exports("StopFireworkText", StopFireworkText)

--- @param lettre string
--- @param pos vector3
--- @param rotation number
--- @param colors table
--- @param index number
local function ShowLetter(lettre, pos, rotation, colors, index)
	local posXCenter = pos.x + math.cos(math.rad(rotation + 90)) * (index * 5)
	local posYCenter = pos.y + math.sin(math.rad(rotation + 90)) * (index * 5)

	for _, v in pairs(Letters[lettre]) do
		UseParticleFxAssetNextCall(asset)

		local posX = posXCenter + math.cos(math.rad(rotation + 90)) * (v[1] * 8)
		local posY = posYCenter + math.sin(math.rad(rotation + 90)) * (v[1] * 8)

		local fx = StartParticleFxLoopedAtCoord(
			particle,
			posX,
			posY,
			pos.z - (v[2] * 8),
			0.0,
			0.0,
			0.0,
			1.0,
			false,
			false,
			false,
			false
		)
		SetParticleFxLoopedColour(fx, colors.r, colors.g, colors.b, 0)
		SetParticleFxLoopedAlpha(fx, 1.0)

		table.insert(fxs, fx)
	end
end

--- @param text string
--- @param pos vector3
--- @param rotation number
--- @param colors table
local function ShowFireworkText(text, pos, rotation, colors)
	LoadAsset()

	if colors == nil then
		colors = { r = 255.0, g = 255.0, b = 255.0 }
	end

	if rotation == nil then
		rotation = 0.0
	end

	if pos == nil then
		print("Error: pos is nil")
		return
	end

	for i = 1, #text do
		ShowLetter(text:sub(i, i), pos, rotation, colors, i)
	end
end
exports("ShowFireworkText", ShowFireworkText)

RegisterCommand("exemple", function(source, args)
	local pos = vector3(-1985.7747, -923.1492, 50.7287)
	ShowFireworkText("HAPPY", pos, 30)
	Wait(1750)
	StopFireworkText()
	ShowFireworkText("NEW", pos, 30)
	Wait(1750)
	StopFireworkText()
	ShowFireworkText("YEAR", pos, 30)
	Wait(1750)
	StopFireworkText()
	ShowFireworkText("2024", pos, 30)
	Wait(1750)
	StopFireworkText()
end)
